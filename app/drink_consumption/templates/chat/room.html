{% load static %}
{% load sass_tags %}

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Chat Room</title>
    <!-- <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Mukta:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous"> -->
    <link href="{% sass_src 'dashboard/css/style2.scss' %}" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <div id="notification" class="notification"></div>

    <script>
      const notification = document.getElementById("notification");

      let timeout;

      function connect() {
        var ws = new WebSocket(
          "ws://" + window.location.host + "/ws/dashboard/"
        );

        ws.onmessage = function (e) {
          const data = JSON.parse(e.data);
          console.log(data);
          notification.classList.add("notification-show");
          clearTimeout(timeout);
          timeout = setTimeout(function () {
            notification.classList.remove("notification-show");
          }, 10000);
        };

        ws.onclose = function (e) {
          console.log("Socket is closed. Reconnect will be attempted in 1 second.", e.reason);
          setTimeout(function () { connect(); }, 1000);
        };

        ws.onerror = function (err) {
          console.error(
            "Socket encountered error: ",
            err.message,
            "Closing socket"
          );
          ws.close();
        };
      }

      connect();
    </script>


  </body>
</html>
